# -*- coding: utf-8 -*-
"""Untitled0.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1oZeLZa4UKYe7NPTdwn9WlBD0-c9dU89Z

verileri toplama
"""

from google.colab import drive
drive.mount('/content/drive')

import os
os.chdir('/content/drive/My Drive/verimadenciliÄŸi/proje-odevi')
!pwd

import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

"""veri setimizden ilk 10 satÄ±rÄ± gÃ¶sterme"""

df=pd.read_csv('StudentPerformanceFactors.csv')
df.head(10)

"""verilerin hazÄ±rlanmasÄ±"""

# Eksik verileri kontrol et ve temizle
print(df.isnull().sum())
df = df.dropna()

# AÅŸÄ±rÄ± uÃ§ deÄŸerleri kaldÄ±r
Q1 = df['Exam_Score'].quantile(0.25)
Q3 = df['Exam_Score'].quantile(0.75)
IQR = Q3 - Q1
outliers = df[(df['Exam_Score'] < (Q1 - 1.5 * IQR)) | (df['Exam_Score'] > (Q3 + 1.5 * IQR))]
df = df[~df.index.isin(outliers.index)]

# Veri tÃ¼rÃ¼ dÃ¶nÃ¼ÅŸÃ¼mÃ¼
df['Exam_Score'] = pd.to_numeric(df['Exam_Score'], errors='coerce')

from sklearn.preprocessing import MinMaxScaler

# Motivation_Level sÃ¼tununu kategorik deÄŸerlerden sayÄ±sal deÄŸerlere dÃ¶nÃ¼ÅŸtÃ¼rme
df['Motivation_Level'] = df['Motivation_Level'].map({'Low': 1, 'Medium': 2, 'High': 3})

# MinMaxScaler ile Normalizasyon
scaler = MinMaxScaler()
df[['Motivation_Level', 'Exam_Score']] = scaler.fit_transform(df[['Motivation_Level', 'Exam_Score']])

# Tekrarlanan satÄ±rlarÄ± kaldÄ±r
df = df.drop_duplicates()

"""motivasyon kÄ±smÄ± burada gÃ¶rselleÅŸtirliyor"""

import seaborn as sns
import matplotlib.pyplot as plt

# Grafik Ã§izimi, legend=False ile palette parametresinin etkili olmasÄ±nÄ± saÄŸlama
sns.countplot(x=df['Motivation_Level'], palette='Set2', legend=False)

# BaÅŸlÄ±k ekleme
plt.title("Motivation Level Distribution")

# GrafiÄŸi gÃ¶sterme
plt.show()

import matplotlib.pyplot as plt
import seaborn as sns
import pandas as pd

# Veri setini yÃ¼kleme
df = pd.read_csv('StudentPerformanceFactors.csv')

# Scatter plot
plt.figure(figsize=(8, 6))
sns.scatterplot(data=df, x='Motivation_Level', y='Exam_Score', color='blue', s=100)

# Grafik baÅŸlÄ±k ve etiketler
plt.title('Motivation Level vs Exam Score', fontsize=16)
plt.xlabel('Motivation Level', fontsize=14)
plt.ylabel('Exam Score', fontsize=14)

# Grafik gÃ¶sterimi
plt.grid(True)
plt.show()

"""Hours_Studied ve Exam_Score karÅŸÄ±laÅŸtÄ±rÄ±lmasÄ± burada"""

import matplotlib.pyplot as plt
import seaborn as sns
import pandas as pd

# Histogram
plt.figure(figsize=(8, 6))
sns.histplot(df['Hours_Studied'], bins=6, kde=True, color='skyblue')

plt.title('Distribution of Hours Studied', fontsize=16)
plt.xlabel('Hours Studied', fontsize=14)
plt.ylabel('Frequency', fontsize=14)
plt.grid(True)
plt.show()

"""Previous_Scores ve Exam_Score Ä°liÅŸkisi (Scatter Plot)"""

import matplotlib.pyplot as plt
import seaborn as sns

# Scatter plot
plt.figure(figsize=(8, 6))
sns.scatterplot(data=df, x='Previous_Scores', y='Exam_Score', color='blue', s=100)

plt.title('Previous Scores vs Exam Score', fontsize=16)
plt.xlabel('Previous Scores', fontsize=14)
plt.ylabel('Exam Score', fontsize=14)
plt.grid(True)
plt.show()

"""Sleep_Hours ve Exam_Score Ä°liÅŸkisi (Scatter Plot)"""

# Scatter plot
plt.figure(figsize=(8, 6))
sns.scatterplot(data=df, x='Sleep_Hours', y='Exam_Score', color='green', s=100)

plt.title('Sleep Hours vs Exam Score', fontsize=16)
plt.xlabel('Sleep Hours', fontsize=14)
plt.ylabel('Exam Score', fontsize=14)
plt.grid(True)
plt.show()

import matplotlib.pyplot as plt
import seaborn as sns
import pandas as pd

# Scatter plot
plt.figure(figsize=(8, 6))
sns.scatterplot(data=df, x='Hours_Studied', y='Exam_Score', color='green', s=100)

# Grafik baÅŸlÄ±k ve etiketler
plt.title('Hours Studied vs Exam Score', fontsize=16)
plt.xlabel('Hours Studied', fontsize=14)
plt.ylabel('Exam Score', fontsize=14)

# Grafik gÃ¶sterimi
plt.grid(True)
plt.show()

"""cinsiyet ve Ã¶ÄŸrenci notunun karÅŸÄ±laÅŸtÄ±rÄ±lmasÄ±

"""

import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

# Gender ve Exam_Score sÃ¼tunlarÄ±nÄ±n mevcut olup olmadÄ±ÄŸÄ±nÄ± kontrol etme
if 'Gender' in df.columns and 'Exam_Score' in df.columns:
    # Gender'e gÃ¶re ortalama Exam Score hesaplama
    gender_avg_scores = df.groupby('Gender')['Exam_Score'].mean().reset_index()

    # Bar Plot
    plt.figure(figsize=(8, 6))
    sns.barplot(data=gender_avg_scores, x='Gender', y='Exam_Score', palette='pastel')

    plt.title('Average Exam Score by Gender', fontsize=16)
    plt.xlabel('Gender', fontsize=14)
    plt.ylabel('Average Exam Score', fontsize=14)
    plt.grid(True)
    plt.show()
else:
    print("Gender veya Exam_Score sÃ¼tunu veri setinde mevcut deÄŸil.")

"""Birden Fazla DeÄŸeri BirleÅŸtiren GÃ¶rselleÅŸtirme"""

import pandas as pd
import seaborn as sns
import matplotlib.pyplot as plt

# Gerekli sÃ¼tunlarÄ±n mevcut olup olmadÄ±ÄŸÄ±nÄ± kontrol etme
required_columns = ['Motivation_Level', 'Hours_Studied', 'Exam_Score', 'Gender']
missing_columns = [col for col in required_columns if col not in df.columns]

if not missing_columns:
    # Pair Plot
    sns.pairplot(df[required_columns], hue='Gender', diag_kind='kde', palette='Set2')

    plt.suptitle('Pair Plot of Motivation, Hours Studied, and Exam Score', y=1.02, fontsize=16)
    plt.show()
else:
    print(f"Veri setinde eksik sÃ¼tunlar var: {', '.join(missing_columns)}")

"""YÃ¼zdesel DaÄŸÄ±lÄ±m ve Etkilerin GÃ¶rselleÅŸtirilmesi
Bu aÅŸamada Motivation_Level, Hours_Studied, Exam_Score, ve Gender deÄŸiÅŸkenlerinin genel etkisini bir Heatmap (IsÄ± HaritasÄ±) ve kategorik yÃ¼zdesel daÄŸÄ±lÄ±m ile gÃ¶rselleÅŸtireceÄŸiz.
"""

# Gender YÃ¼zdesel DaÄŸÄ±lÄ±mÄ±
gender_percentage = df['Gender'].value_counts(normalize=True) * 100

# Bar Plot
plt.figure(figsize=(8, 6))
sns.barplot(x=gender_percentage.index, y=gender_percentage.values, palette='pastel')

# Grafik BaÅŸlÄ±k ve Etiketler
plt.title('Percentage Distribution of Gender', fontsize=16)
plt.xlabel('Gender', fontsize=14)
plt.ylabel('Percentage (%)', fontsize=14)
plt.ylim(0, 100)

# YÃ¼zdelik Etiketler
for i, val in enumerate(gender_percentage.values):
    plt.text(i, val + 1, f'{val:.1f}%', ha='center', fontsize=12)

plt.show()

import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

# Gerekli sÃ¼tunlarÄ± belirleme
numerical_columns = ['Motivation_Level', 'Hours_Studied', 'Exam_Score']

# Motivation_Level sÃ¼tununu kategorik deÄŸerlerden sayÄ±sal deÄŸerlere dÃ¶nÃ¼ÅŸtÃ¼rme (eÄŸer dÃ¶nÃ¼ÅŸÃ¼m yapÄ±lmamÄ±ÅŸsa)
if 'Motivation_Level' in df.columns and df['Motivation_Level'].dtype == 'object':
    df['Motivation_Level'] = df['Motivation_Level'].map({'Low': 1, 'Medium': 2, 'High': 3})

# SayÄ±sal olmayan deÄŸerleri sayÄ±sala Ã§evirme ve eksik deÄŸerleri temizleme
df = df.dropna(subset=numerical_columns)

# Korelasyon matrisi oluÅŸturma
correlation_matrix = df[numerical_columns].corr()

# Korelasyon matrisini gÃ¶rselleÅŸtirme
plt.figure(figsize=(8, 6))
sns.heatmap(correlation_matrix, annot=True, fmt='.2f', cmap='coolwarm', cbar=True)
plt.title('Correlation Heatmap of Variables', fontsize=16)
plt.show()

import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

# Gender'e gÃ¶re ortalama Exam_Score hesaplama ve gÃ¶rselleÅŸtirme
if 'Gender' in df.columns and 'Exam_Score' in df.columns:
    gender_effect = df.groupby('Gender', as_index=False)['Exam_Score'].mean()

    # Bar Plot
    plt.figure(figsize=(8, 6))
    sns.barplot(data=gender_effect, x='Gender', y='Exam_Score', palette='Set2')

    plt.title('Average Exam Score by Gender', fontsize=16)
    plt.xlabel('Gender', fontsize=14)
    plt.ylabel('Average Exam Score', fontsize=14)
    plt.ylim(0, 100)
    plt.grid(True)
    plt.show()
else:
    print("Gender veya Exam_Score sÃ¼tunu veri setinde mevcut deÄŸil.")

"""3. aÅŸamaya geÃ§iyoruz artÄ±k makine Ã¶ÄŸrenmesi yapacaÄŸÄ±z.

Hedef ve Ã–zelliklerin SeÃ§ilmesi
"""

# Ã–zellikler ve hedef deÄŸiÅŸken
required_columns = ['Motivation_Level', 'Hours_Studied', 'Previous_Scores', 'Attendance', 'Exam_Score']
missing_columns = [col for col in required_columns if col not in df.columns]

if not missing_columns:
    X = df[['Motivation_Level', 'Hours_Studied', 'Previous_Scores', 'Attendance']]  # BaÄŸÄ±msÄ±z deÄŸiÅŸkenler
    y = df['Exam_Score']  # Hedef deÄŸiÅŸken
    print("BaÄŸÄ±msÄ±z ve hedef deÄŸiÅŸkenler baÅŸarÄ±yla tanÄ±mlandÄ±.")
else:
    print(f"Veri setinde eksik sÃ¼tunlar var: {', '.join(missing_columns)}")

from sklearn.preprocessing import LabelEncoder

# Gender deÄŸiÅŸkenini sayÄ±sal deÄŸere Ã§evirme
label_encoder = LabelEncoder()
df['Gender'] = label_encoder.fit_transform(df['Gender'])  # Male=1, Female=0

"""Veri BÃ¶lme
Modeli eÄŸitmek iÃ§in veriyi iki parÃ§aya ayÄ±rmalÄ±sÄ±nÄ±z:

EÄŸitim Verisi (Training Data): Modelin Ã¶ÄŸrenmesi iÃ§in (%60)
Test Verisi (Testing Data): Modelin doÄŸruluÄŸunu deÄŸerlendirmek iÃ§in (%40) ayrÄ±ldÄ±


"""

from sklearn.model_selection import train_test_split
# Veriyi eÄŸitim ve test kÃ¼melerine ayÄ±rma
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.4, random_state=42)

from sklearn.linear_model import ElasticNet

# ElasticNet Regression modeli oluÅŸturma
elastic_net_model = ElasticNet(alpha=1.0, l1_ratio=0.5, random_state=42)

# Modeli eÄŸitme (Ã¶nceden oluÅŸturulmuÅŸ eÄŸitim verisi kullanÄ±larak)
elastic_net_model.fit(X_train, y_train)

print("ElasticNet Regression Modeli baÅŸarÄ±yla eÄŸitildi.")

"""4. AÅŸamaya geÃ§tik"""

from sklearn.metrics import mean_squared_error, r2_score
from sklearn.linear_model import ElasticNet

# Test verilerinden tahmin yap
y_pred = elastic_net_model.predict(X_test)

# Performans deÄŸerlendirme metrikleri
mse = mean_squared_error(y_test, y_pred)
r2 = r2_score(y_test, y_pred)

print("ElasticNet Regression PerformansÄ±:")
print("Mean Squared Error (MSE):", mse)
print("RÂ² Score:", r2)

"""5. aÅŸamaya geÃ§iyoruz performansÄ±n arttÄ±rÄ±lmasÄ±

linear Regression ile deneme
"""

# from sklearn.linear_model import LinearRegression
# from sklearn.metrics import mean_squared_error, r2_score
# import pandas as pd


# # Gerekli sÃ¼tunlarÄ±n mevcut olup olmadÄ±ÄŸÄ±nÄ± kontrol et
# required_columns = ['Motivation_Level', 'Hours_Studied', 'Previous_Scores', 'Attendance', 'Exam_Score']
# missing_columns = [col for col in required_columns if col not in df.columns]

# if not missing_columns:
#     # BaÄŸÄ±msÄ±z ve baÄŸÄ±mlÄ± deÄŸiÅŸkenleri ayÄ±rma
#     X = df[['Motivation_Level', 'Hours_Studied', 'Previous_Scores', 'Attendance']]
#     y = df['Exam_Score']

#     # Linear Regression modeli oluÅŸturma
#     lr_model = LinearRegression()

#     # EÄŸitim verisiyle modeli eÄŸitme
#     lr_model.fit(X_train, y_train)

#     # Test verisi Ã¼zerinde tahmin
#     y_pred = lr_model.predict(X_test)

#     # Performans Ã¶lÃ§Ã¼mleri
#     mse = mean_squared_error(y_test, y_pred)
#     r2 = r2_score(y_test, y_pred)

#     print("Linear Regression Model PerformansÄ±:")
#     print("Mean Squared Error (MSE):", mse)
#     print("RÂ² Score:", r2)
# else:
#     print(f"Veri setinde eksik sÃ¼tunlar var: {', '.join(missing_columns)}")



from sklearn.linear_model import LinearRegression
from sklearn.metrics import mean_squared_error, r2_score
import pandas as pd
import joblib  # Model kaydetme iÅŸlemi iÃ§in gerekli

# df veri Ã§erÃ§evesinin (DataFrame) daha Ã¶nceden tanÄ±mlandÄ±ÄŸÄ±nÄ± varsayÄ±yoruz.

# Gerekli sÃ¼tunlarÄ±n mevcut olup olmadÄ±ÄŸÄ±nÄ± kontrol et
required_columns = ['Motivation_Level', 'Hours_Studied', 'Previous_Scores', 'Attendance', 'Exam_Score']
missing_columns = [col for col in required_columns if col not in df.columns]

if not missing_columns:
    # BaÄŸÄ±msÄ±z ve baÄŸÄ±mlÄ± deÄŸiÅŸkenleri ayÄ±rma
    X = df[['Motivation_Level', 'Hours_Studied', 'Previous_Scores', 'Attendance']]
    y = df['Exam_Score']

    # EÄŸitim ve test verilerinin daha Ã¶nceden bÃ¶lÃ¼ndÃ¼ÄŸÃ¼nÃ¼ varsayalÄ±m (X_train, y_train, X_test, y_test)

    # Linear Regression modeli oluÅŸturma
    lr_model = LinearRegression()

    # EÄŸitim verisiyle modeli eÄŸitme
    lr_model.fit(X_train, y_train)

    # Test verisi Ã¼zerinde tahmin
    y_pred = lr_model.predict(X_test)

    # Performans Ã¶lÃ§Ã¼mleri
    mse = mean_squared_error(y_test, y_pred)
    r2 = r2_score(y_test, y_pred)

    print("Linear Regression Model PerformansÄ±:")
    print("Mean Squared Error (MSE):", mse)
    print("RÂ² Score:", r2)

    # Modeli kaydetme iÅŸlemi: 'linear_regression_model.pkl' dosyasÄ±na kaydediyoruz
    joblib.dump(lr_model, "linear_regression_model.pkl")
    print("Model kaydedildi: linear_regression_model.pkl")
else:
    print(f"Veri setinde eksik sÃ¼tunlar var: {', '.join(missing_columns)}")

!pip install flask-ngrok
!pip install pyngrok
!pip install flask-cors

!ngrok authtoken 2u8W98iOaP0kJquHaRzS6zHAbtm_6AwVS1ejSP4PbzZSRu8z2

# from flask import Flask, request, jsonify
# import joblib
# import numpy as np
# from pyngrok import ngrok

# app = Flask(__name__)

# # KaydedilmiÅŸ modeli yÃ¼kle
# model = joblib.load("linear_regression_model.pkl")

# @app.route("/")
# def home():
#     return "Flask API Ã§alÄ±ÅŸÄ±yor!"

# # Tahmin yapacak API endpoint'i
# @app.route('/predict', methods=['POST'])
# def predict():
#     try:
#         # KullanÄ±cÄ±dan gelen JSON verisini al
#         data = request.get_json()

#         # Veriyi numpy dizisine Ã§evir ve uygun forma getir
#         input_features = np.array(data['features']).reshape(1, -1)

#         # Model ile tahmin yap
#         prediction = model.predict(input_features)

#         # Sonucu JSON formatÄ±nda dÃ¶ndÃ¼r
#         return jsonify({'prediction': prediction.tolist()})

#     except Exception as e:
#         return jsonify({'error': str(e)})

# # Flask Sunucusunu BaÅŸlat
# port = 5000
# public_url = ngrok.connect(port).public_url
# print(f"ğŸ”¥ Public URL: {public_url}")

# # Flask'i Arka Planda Ã‡alÄ±ÅŸtÄ±r
# app.run(port=port)


from flask import Flask, request, jsonify
import joblib
import numpy as np
from pyngrok import ngrok
from flask_cors import CORS  # CORS desteÄŸini ekledik

app = Flask(__name__)
CORS(app)  # TÃ¼m kaynaklara izin veriyoruz

# KaydedilmiÅŸ modeli yÃ¼kle
model = joblib.load("linear_regression_model.pkl")

@app.route("/")
def home():
    return "Flask API Ã§alÄ±ÅŸÄ±yor!"

@app.route('/predict', methods=['POST'])
def predict():
    try:
        data = request.get_json()
        input_features = np.array(data['features']).reshape(1, -1)
        prediction = model.predict(input_features)
        return jsonify({'prediction': prediction.tolist()})
    except Exception as e:
        return jsonify({'error': str(e)})

# Flask Sunucusunu BaÅŸlat
port = 5000
public_url = ngrok.connect(port).public_url
print(f"ğŸ”¥ Yeni Public URL: {public_url}")

app.run(port=port)